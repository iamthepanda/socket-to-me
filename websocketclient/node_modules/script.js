var socket = new WebSocket("ws://"+ip+":8080/", "direction-protocol")

var buffer = '';
var scrolled = false;
var repeatRateTimer = null;

socket.onopen = function (event) {
  // console.log(document.getElementById('msg').innerHTML);
  socket.send("");
}


socket.onmessage = function (event) {
  document.getElementById('log').innerHTML = message.data;
  buffer = event.data;
  console.log(buffer);
  document.getElementById('log').innerHTML = event.data;
  updateScroll();
}

window.onkeydown = function(e) {
    var key = e.keyCode ? e.keyCode : e.which;

    // focus on chat box on 'enter' keypress
    if (key == 13) {
      document.getElementById("msg").focus();
    }

}

window.myFunction = function(){
  if(document.getElementById('msg').value != ''){
    socket.send('<br>'+document.getElementById('msg').value+'');

    document.getElementById('msg').value= '';
    document.getElementById("msg").focus();
  }

  return false; // to prevent page from refreshing after submitting form
}

// focus on chat box when window loads
window.onload = function() {
  document.getElementById("msg").focus();
}

// scrolls to the bottom of the chat log
function updateScroll() {
  if(!scrolled) {
    var element = document.getElementById('log');
    element.scrollTop = element.scrollHeight;
  }
}